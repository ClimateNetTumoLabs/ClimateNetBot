{% extends "admin/change_list.html" %}
{% block content %}
    {% block head %}
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/acss/dist/acss.min.css">
    {% endblock %}
    {{ block.super }}
    <style>
        body{
            
        }
        .chart_command_popular{
            display:flex;
            width:100%%;
            justify-content:space-between;
            gap:40px;
        }
        
    </style>
    <h2>Bot Analytics Dashboard</h2>

    <div class="chart_command_popular">
        
        <div style="background: #2C3E50; color: white; padding: 20px; border-radius: 10px;">
            <h3>Total Users Overview</h3>
            <p><b>Total Users:</b> {{ total_users }}</p>
            <p><b>Active Users (Last 7 Days):</b> {{ active_users }}</p>
            <p><b>New Users (Last 7 Days):</b> {{ new_users }}</p>
            <p><b>Inactive Users (Last 30 Days):</b> {{ inactive_users }}</p>
            <p><b>Engagement Rate:</b> {{ engagement_rate|floatformat:2 }}%</p>
            <p><b>Total Commands:</b> {{ total_commands }}</p>
            
        </div>
        
        <div style="background: #2C3E50; color: white; padding: 20px; border-radius: 10px; margin-top:20px; ">
            <h3>Popular Devices</h3>
            <canvas id="popularDevicesChart"></canvas>
        </div>
    </div>
    <div class="command_usage" style=" background: #2C3E50; color: white; padding: 20px; border-radius: 10px; margin-top:20px;  ">
        <h3>Command Usage</h3>
        <canvas style="max-height:300px;" id="commandUsageChart" ></canvas>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Command usage data
        const commandLabels = {{ command_usage|safe }};
        const commandCounts = {{ command_usage|safe }};

        new Chart(document.getElementById('commandUsageChart'), {
            type: 'bar',
            data: {
                labels: commandLabels.map(item => item.command),
                datasets: [{
                    label: 'Usage Count',
                    data: commandCounts.map(item => item.total),
                    backgroundColor: 'rgba(75, 192, 192, 0.2)',
                    borderColor: 'rgba(75, 192, 192, 1)',
                    borderWidth: 1
                }]
            },
            options: { responsive: true }
        });

        // Popular devices data
        const deviceLabels = {{ popular_devices|safe }};
        const deviceCounts = {{ popular_devices|safe }};

        new Chart(document.getElementById('popularDevicesChart'), {
            type: 'pie',
            data: {
                labels: deviceLabels.map(item => item.device_location),
                datasets: [{
                    label: 'Device Usage',
                    data: deviceCounts.map(item => item.total),
                    backgroundColor: ['#FF6384', '#36A2EB', '#FFCE56'],
                }]
            },
            options: { responsive: true }
        });
    </script>
{% endblock %}


{% comment %} 

{% extends "admin/change_list.html" %}
{% block content %}
    {{ block.super }}

    <h2 style="text-align: center; margin-bottom: 20px;">Bot Analytics Dashboard</h2>

    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px;">

        <!-- Total Users Overview -->
        <div style="background: #2C3E50; color: white; padding: 20px; border-radius: 10px;">
            <h3>Total Users Overview</h3>
            <p><b>Total Users:</b> {{ total_users }}</p>
            <p><b>Active Users (Last 7 Days):</b> {{ active_users }}</p>
            <p><b>New Users (Last 7 Days):</b> {{ new_users }}</p>
            <p><b>Inactive Users (Last 30 Days):</b> {{ inactive_users }}</p>
            <p><b>Engagement Rate:</b> {{ engagement_rate|floatformat:2 }}%</p>
            <p><b>Total Commands:</b> {{ total_commands }}</p>
        </div>

        <!-- Command Usage -->
        <div style="background: #34495E; color: white; padding: 20px; border-radius: 10px;">
            <h3>Command Usage</h3>
            <canvas id="commandUsageChart" style="max-width: 100%;"></canvas>
        </div>

        <!-- Successful Commands -->
        <div style="background: #1ABC9C; color: white; padding: 20px; border-radius: 10px;">
            <h3>Successful Commands</h3>
            <p><b>Success Rate:</b> {{ success_rate|floatformat:2 }}%</p>
            <p><b>Successful Commands:</b> {{ successful_commands }}</p>
        </div>

        <!-- Device Activity -->
        <div style="background: #8E44AD; color: white; padding: 20px; border-radius: 10px;">
            <h3>Device Activity</h3>
            <canvas id="popularDevicesChart" style="max-width: 100%;"></canvas>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Command usage data
        const commandUsageData = {{ command_usage|safe }};
        const commandLabels = commandUsageData.map(item => item.command);
        const commandCounts = commandUsageData.map(item => item.total);

        new Chart(document.getElementById('commandUsageChart'), {
            type: 'bar',
            data: {
                labels: commandLabels,
                datasets: [{
                    label: 'Usage Count',
                    data: commandCounts,
                    backgroundColor: 'rgba(75, 192, 192, 0.6)',
                    borderColor: 'rgba(75, 192, 192, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: { display: false }
                }
            }
        });

        // Popular devices data
        const deviceActivityData = {{ device_activity|safe }};
        const deviceLabels = deviceActivityData.map(item => item.device_location);
        const deviceCounts = deviceActivityData.map(item => item.total);

        new Chart(document.getElementById('popularDevicesChart'), {
            type: 'pie',
            data: {
                labels: deviceLabels,
                datasets: [{
                    label: 'Device Activity',
                    data: deviceCounts,
                    backgroundColor: ['#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0'],
                }]
            },
            options: { responsive: true }
        });
    </script>
{% endblock %}


{% endcomment %}